@using System

@model Post

@{
    //Check the type of user 1st
    bool isBlog = ViewBag.isBlog != null && Boolean.Parse(ViewBag.isBlog);

    if (User.IsInRole("admin") && !isBlog)
    Layout = "~/Views/Shared/_Dashboard.cshtml";

    Post post = Model;
    string placeholder = (post.Status == "draft") ? "Draft" : "Post"; //Lets us know if its a draft or a normal post

    
}



<section class="content">

<div class="container mt-5">

    @*The post*@
    <div class="pt-2">
        <div class="post-title">
            <h2><strong>@post.Title</strong></h2>
        </div>
        <div class="cover-photo pt-4 mt-lg-5" style="">
              <img class="img-fluid" src="@post.PhotoUrl" />
        </div>
            <div class="pt-4 ps-lg-4 pe-lg-4 mt-lg-4">
            <div class="row d-flex">
                <div class="col-6">
                    <h5 class="date"><strong>@post.DatePublished.ToString("dd MMMM yyyy")</strong></h5>
                </div>
                <div class="col-6 text-end pe-5">
                    <h5 class="author"><strong>@post.User.Name @post.User.Surname</strong></h5>
                </div>
            </div>

            <div class="pt-3 post-content text-justify">
                @Html.Raw(@post.Content)
            </div>
        </div>
    </div>

    @if(isBlog){
        <div class="services-cta">
            <h2>Unlock the Power of Our Services</h2>
            <p>Explore our comprehensive service packages tailored just for you!</p>
            <a class="btn btn-primary" asp-controller="Packages" asp-action="Index">Discover Now</a>
        </div>
        }
    

    @if (User.IsInRole("admin") && !isBlog)
    {
            <hr class="mt-5" />
        <div class="pt-4 d-flex">
            <div>
                @*Making use of Url Paramters*@
                <a class="btn btn-primary btn-block me-4 pe-3 ps-3"
                href="@Url.Action("PostEditor", "Post", new {act = "Update", value = post.Id})">Update @placeholder</a>

            </div>


            <div>
                <form id="form" method="post" asp-action="Delete" asp-controller="Post" asp-route-id="@post.Id">
                    <button type="button" class="btn btn-danger btn-block pe-3 ps-3" onclick="confirmDelete(@post.Id)">Delete @placeholder</button>
                </form>
            </div>

        </div>

            <hr class="mt-5 mb-5" />
    }

    
</div>

</section>

<!-- Modal -->
<div class="modal fade" id="deleteUser" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Delete @placeholder</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this @placeholder?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete</button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        function confirmDelete(userId) {
            $('#deleteUser').modal('show');

            $('#confirmDeleteButton').unbind().click(function () {
                $('form').submit();
            });
        }
    </script>
}



