@using System
@using System.Text.RegularExpressions
@model IEnumerable<Post>

@functions {
    static string RemoveHtmlTags(string input)
    {
        
        input = input.Replace("&nbsp;", " ");
        return Regex.Replace(input, "<.*?>", String.Empty);
    }

    IEnumerable<Post> SortByLatest()
    {
        IEnumerable<Post> ordered = Model.Take(4);
        return ordered;
    }
}

@{
    var isBlog = new Dictionary<string, string>
            {
                { "isBlog", "true" }
            };
}
    @*Search*@
    <section>

    <div class="container">
        <div class="blog-heading mt-3 pt-5 mb-5">
                    
                <h2>Blog Posts</h2>        
        </div>
        </div>
    </section>


@if(Model is not null && Model.Any())
{
    Post leadPost = Model.First();
    IEnumerable<Post> latestPosts = SortByLatest();
    
    @*Hero Section*@
    <section>

        <div class="container">
            <div class="row hero d-flex mt-5 pt-4">
                <div class="col-12 col-md-7 lead-post">
                    <a asp-controller="Post" asp-action="PostDetails" asp-all-route-data="isBlog" asp-route-id="@leadPost.Id">
                        <div class="hero-image">
                            <img src=@leadPost.PhotoUrl></img>

                        </div>
                        <h5><strong>@leadPost.Title</strong></h5>
                        <p class="card-text">
                            @(leadPost.Content.Length < 100 ? RemoveHtmlTags(leadPost.Content.Substring(0, leadPost.Content.Length))+"..." : @RemoveHtmlTags(leadPost.Content.Substring(0, 180) + "..."))
                        </p>
                    </a>
                </div>

                <div class="col col-md-4 latest-nav">
                    <div class="latest-top row">
                        <h2 class="col">Latest</h2>
                        <a class="col text-end" href="#">
                            <h3>More...</h3>
                        </a>
                    </div>

                    <hr />
                    <div class="col-sm-12 latest-posts-list">
                        @foreach (var post in @latestPosts.Take(4))
                        {
                            <div class="mt-3">
                                <a asp-controller="Post" asp-action="PostDetails" asp-all-route-data="isBlog" asp-route-id="@post.Id">
                                    <h5>@post.DatePublished.ToString("dd MMMM yyyy")</h5>
                                    <h4>@post.Title</h4>

                                </a>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </section>

    @*Featured Post Section*@
    <section class="container post mt-5 mt-md-3 ">
        <div class="container">

            <div class="heading">
                <h2>Featured</h2>
            </div>

            <div class="row mt-3 g-5">
                @foreach (var post in Model)
                {
                    <div class="post-items col-md-6 col-lg-4  d-flex justify-content-center">
                        @*The a tag is used to make the whole post card clickable*@
                        <a asp-controller="Post" asp-action="PostDetails" asp-all-route-data="isBlog" asp-route-id="@post.Id">
                            <div class="blog-post card h-100" style="max-width: 25rem;">
                                @if (String.IsNullOrEmpty(post.PhotoUrl))
                                {
                                    <img src="/img/background1.png" class="card-img-top"/>
                                }
                                else
                                {
                                    <img src="@post.PhotoUrl" class="card-img-top" alt="..." />
                                }
                                <div class="card-body pb-1">
                                    <div class="row" style="font-size: 12px;">
                                        <p class="author col fw-bold">@post.User.Name @post.User.Surname</p>
                                        <p class="date col fw-bold text-end">@post.DatePublished.ToString("dd MMMM yyyy")</p>
                                    </div>
                                    <h5 class="card-title">@post.Title</h5>
                                    <p class="card-text">@RemoveHtmlTags(@post.Content.Substring(0,100))...</p>
                                </div>
                            </div>
                        </a>
                    </div>
                }
            </div>

            

        </div>
    </section>
}
else
{
    <section>
        <div class="container">
            <div class="no-content d-flex justify-content-center align-items-center flex-column">
                <h2>No Blog Posts</h2>
                <p>Apologies, there are no blogs available at this moment. Check back later for updates.</p>
                <img class="pt-5" src="~/img/work-in-progress.png"/>
            </div>
        </div>
    </section>
}





